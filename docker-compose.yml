version: '3.4'

services:

  mysql:
    image: mysql:latest

  rabbitmq:
    image: rabbitmq:3-management-alpine

  redis:
    image: redis:alpine

  zipkin:
    image: openzipkin/zipkin-slim

  daprtest.payapi:
    image: ${DOCKER_REGISTRY-}daprtestpayapi
    build:
      context: .
      dockerfile: DaprTest.PayApi/Dockerfile
  daprtest.payapi.dapr:
    image: "daprio/daprd:latest"
    depends_on:
      - daprtest.payapi
    network_mode: "service:daprtest.payapi"

  daprtest.storeapi:
    image: ${DOCKER_REGISTRY-}daprteststoreapi
    build:
      context: .
      dockerfile: DaprTest.StoreApi/Dockerfile
  daprtest.storeapi.dapr:
    image: "daprio/daprd:latest"
    depends_on:
      - daprtest.storeapi
    network_mode: "service:daprtest.storeapi"

  daprtest.tenantapi:
    image: ${DOCKER_REGISTRY-}daprtesttenantapi
    build:
      context: .
      dockerfile: DaprTest.TenantApi/Dockerfile
  daprtest.tenantapi.dapr:
    image: "daprio/daprd:latest"
    depends_on:
      - daprtest.tenantapi
    network_mode: "service:daprtest.tenantapi"

  daprtest.orderapi:
    image: ${DOCKER_REGISTRY-}daprtestorderapi
    build:
      context: .
      dockerfile: DaprTest.OrderApi/Dockerfile   
  daprtest.orderapi.dapr:
    image: "daprio/daprd:latest"
    depends_on:
      - daprtest.orderapi
    network_mode: "service:daprtest.orderapi"

  daprtest.productapi:
    image: ${DOCKER_REGISTRY-}daprtestproductapi
    build:
      context: .
      dockerfile: DaprTest.ProductApi/Dockerfile
  daprtest.productapi.dapr:
    image: "daprio/daprd:latest"
    depends_on:
      - daprtest.productapi
    network_mode: "service:daprtest.productapi"


  daprtest.memberapi:
    image: ${DOCKER_REGISTRY-}daprtestmemberapi
    build:
      context: .
      dockerfile: DaprTest.MemberApi/Dockerfile
  daprtest.memberapi.dapr:
    image: "daprio/daprd:latest"
    depends_on:
      - daprtest.memberapi
    network_mode: "service:daprtest.memberapi"


  daprtest.identityserver:
    image: ${DOCKER_REGISTRY-}daprtestidentityserver
    build:
      context: .
      dockerfile: DaprTest.IdentityServer/Dockerfile

  daprtest.ui.mvc:
    image: ${DOCKER_REGISTRY-}daprtestuimvc
    build:
      context: .
      dockerfile: DaprTest.UI.MVC/Dockerfile

  daprtest.ui.js:
    image: ${DOCKER_REGISTRY-}uijs
    build:
      context: .
      dockerfile: DaprTest.UI.JS/wwwroot/Dockerfile


  daprtest.nginxgateway:
    image: nginxgateway
    build:
      context: .
      dockerfile: gateway/nginxgateway/Dockerfile





